<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/images/logo/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
  <title>Register - Rolnopol</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>

<body class="bg-agri-pattern">
  <!-- Dynamic Header Component -->
  <div id="header-component"></div>

  <div class="container" style="margin-top: 0rem" data-testid="register-container">
    <header class="header glass" style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 0.75rem 0 1rem 0;
          margin-bottom: 1.5rem;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
          border-radius: 1rem 1rem 0 0;
        ">
      <div style="
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
            justify-content: center;
          ">
        <h1 style="
              display: flex;
              align-items: center;
              gap: 0.5rem;
              font-size: 1.75rem;
            ">
          <span class="bg-agri-gradient"><i class="fas fa-tractor"></i></span>
        </h1>
        <div style="
              display: flex;
              flex-direction: column;
              align-items: flex-start;
            ">
          <span class="main-title" style="font-size: 1.75rem">Rolnopol</span>
          <span data-testid="register-subtitle" style="
                font-size: 0.9rem;
                color: #6a7b5e;
                font-weight: 400;
                margin-top: 0.1rem;
              ">Create Your User Account</span>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="auth-form-container" data-testid="auth-form-container">
        <div class="auth-form glass fade-in" style="box-shadow: 0 8px 32px 0 rgba(34, 197, 94, 0.1)" data-testid="register-form-container">
          <h2 style="display: flex; align-items: center; gap: 0.5rem">
            <span class="bg-agri-gradient"><i class="fas fa-seedling"></i></span>
            Create Your User Account
          </h2>
          <form id="registerForm" data-testid="register-form">
            <div class="form-group">
              <label for="email" class="form-label">Email</label>
              <input type="email" id="email" name="email" class="form-input" required placeholder="Enter your email (e.g., john@example.com)" data-testid="email-input" />
            </div>
            <div class="form-group">
              <label for="displayedName" class="form-label">Display Name <span style="color:#6a7b5e;font-weight:400">(optional)</span></label>
              <input type="text" id="displayedName" name="displayedName" class="form-input" placeholder="Enter your display name (e.g., John Doe)" minlength="3" maxlength="20" data-testid="display-name-input" />
            </div>
            <div class="form-group">
              <label for="password" class="form-label">Password</label>
              <input type="password" id="password" name="password" class="form-input" required placeholder="Enter your password" minlength="3" data-testid="password-input" />
            </div>

            <button type="submit" class="btn btn-agri btn-full" data-testid="register-submit-btn">
              Create Account
            </button>
          </form>

          <div id="message" class="message" data-testid="register-message"></div>

          <div class="auth-links" data-testid="auth-links">
            <p>
              Already have an account? <a href="/login.html" data-testid="login-link">Login here</a>
            </p>
            <p><a href="/" data-testid="home-link">Back to Home</a></p>
          </div>
        </div>

        <div class="auth-info glass" style="border-left: 4px solid var(--agri-green)">
          <h3>
            <i class="fas fa-tractor" style="color: var(--agri-green)"></i>
            Registration Guidelines
          </h3>
          <ul>
            <li>
              <strong>Email:</strong> This will be used to sign in to your account.<br />Make sure it's valid.
            </li>
            <li>
              <strong>Display Name:</strong> This is what others will see.<br>If not provided, your email will be shown.
            </li>
            <li id="password-guideline">
              <strong>Password:</strong> Must be at least 3 characters long.
            </li>
          </ul>
        </div>
      </div>
    </main>

    <!-- Dynamic Footer Component -->
    <div id="footer-component"></div>
  </div>
  <!-- Core Dependencies -->
  <script src="/js/core/event-bus.js"></script>
  <script src="/js/core/storage.js"></script>
  <script src="/js/core/app.js"></script>

  <!-- Services -->
  <script src="/js/services/api-service.js"></script>
  <script src="/js/services/auth-service.js"></script>
  <!-- Components -->
  <script src="/js/components/notification.js"></script>
  <script src="/js/components/navigation.js"></script>
  <script src="/js/components/form.js"></script>
  <script src="/js/components.js"></script>

  <!-- API Functions -->
  <script src="/js/api.js"></script>

  <!-- Utilities -->
  <script src="/js/utils/error-logger.js"></script>
  <script src="/js/utils/utils.js"></script>
  <script src="/js/utils/router.js"></script>
  <script src="/js/utils/global-compat.js"></script>
  <!-- Main Application -->
  <script src="/js/app.js"></script>
  <script src="/js/utils/init-navigation.js"></script>
  <script>
    initNavigation("register");
  </script>

  <script>
    // Global logout function
    function logout() {
      if (window.App && window.App.getModule("authService")) {
        const authService = window.App.getModule("authService");
        authService
          .logout()
          .then(() => {
            window.location.href = "/";
          })
          .catch((error) => {
            errorLogger.log("Logout", error, { showToUser: false });
            window.location.href = "/";
          });
      } else {
        // Fallback logout
        localStorage.removeItem("authToken");
        sessionStorage.removeItem("authToken");
        window.location.href = "/";
      }
    }
  </script>
</body>

</html>