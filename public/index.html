<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/images/logo/favicon.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rolnopol</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    /* Custom tooltip styles for statistics */
    .stat-block {
      position: relative;
      cursor: help;
    }

    .stat-block:hover {
      z-index: 99998;
    }

    .stat-block:hover::after {
      content: attr(title);
      position: absolute;
      top: 100%;
      left: 50%;
      width: max-content;
      max-width: 300px;
      min-width: 200px;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 0.8rem 1rem;
      border-radius: 0.6rem;
      font-size: 0.85rem;
      white-space: normal;
      line-height: 1.4;
      z-index: 99999;
      margin-top: 0.3rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      text-align: center;
      pointer-events: none;
    }

    .stat-block:hover::before {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 8px solid transparent;
      border-bottom-color: rgba(0, 0, 0, 0.9);
      margin-top: -0.3rem;
      z-index: 99999;
      pointer-events: none;
    }

    .welcome-video-block {
      position: relative;
      width: 65%;
      max-width: 780px;
      margin: 0 auto;
      aspect-ratio: 16 / 9;
      border-radius: 0.8rem;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .welcome-video-skeleton {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(110deg, rgba(106, 123, 94, 0.12) 8%, rgba(106, 123, 94, 0.2) 18%, rgba(106, 123, 94, 0.12) 33%);
      background-size: 200% 100%;
      animation: homeVideoSkeletonShimmer 1.2s linear infinite;
      z-index: 1;
      transition: opacity 0.3s ease;
      opacity: 1;
    }

    .welcome-video-skeleton.is-hidden {
      opacity: 0;
      pointer-events: none;
    }

    .welcome-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 2;
    }

    .welcome-video.is-loaded {
      opacity: 1;
    }

    @keyframes homeVideoSkeletonShimmer {
      to {
        background-position-x: -200%;
      }
    }

    .home-modern-main {
      margin-bottom: 1.2rem;
    }

    html.home-modern-prefers-modern #home-legacy-header,
    html.home-modern-prefers-modern #home-legacy-main {
      display: none !important;
    }

    html.home-modern-prefers-modern .js-home-modern-main {
      display: block !important;
    }

    .home-modern-hero {
      position: relative;
      overflow: hidden;
      border-radius: 1.2rem;
      padding: 1.6rem 1.2rem;
      background:
        radial-gradient(circle at 15% 10%, rgba(106, 123, 94, 0.18), transparent 45%),
        radial-gradient(circle at 85% 20%, rgba(52, 140, 240, 0.12), transparent 55%),
        linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 253, 246, 0.9));
      border: 1px solid rgba(106, 123, 94, 0.18);
      box-shadow: 0 16px 40px rgba(45, 58, 45, 0.12);
    }

    .home-modern-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.65rem;
      border-radius: 999px;
      font-size: 0.78rem;
      letter-spacing: 0.02em;
      color: #2d3a2d;
      background: rgba(106, 123, 94, 0.14);
      border: 1px solid rgba(106, 123, 94, 0.25);
      margin-bottom: 0.8rem;
      font-weight: 600;
    }

    .home-modern-title {
      margin: 0;
      font-size: clamp(1.45rem, 2.5vw, 2rem);
      color: #233023;
      display: flex;
      align-items: center;
      gap: 0.55rem;
      justify-content: center;
      text-align: center;
    }

    .home-modern-subtitle {
      margin: 0.75rem auto 1rem;
      max-width: 650px;
      text-align: center;
      color: #4d6450;
      font-size: 1rem;
      line-height: 1.55;
    }

    .home-modern-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 0.75rem;
      margin-top: 1.1rem;
    }

    .home-modern-kpi {
      border-radius: 0.8rem;
      border: 1px solid rgba(106, 123, 94, 0.22);
      background: rgba(255, 255, 255, 0.72);
      backdrop-filter: blur(6px);
      padding: 0.75rem 0.7rem;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .home-modern-kpi:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 22px rgba(45, 58, 45, 0.1);
    }

    .home-modern-kpi__icon {
      font-size: 1.1rem;
      color: #6a7b5e;
      margin-bottom: 0.25rem;
    }

    .home-modern-kpi__value {
      font-size: 1.15rem;
      font-weight: 700;
      color: #223022;
      min-height: 1.4rem;
    }

    .home-modern-kpi__label {
      color: #617662;
      font-size: 0.8rem;
      font-weight: 600;
      margin-top: 0.2rem;
    }

    .home-modern-actions {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 0.7rem;
      flex-wrap: wrap;
    }

    .home-modern-note {
      text-align: center;
      color: #5b6f5d;
      font-size: 0.84rem;
      margin-top: 0.8rem;
    }

    /* Modern Header Styles */
    .home-modern-header {
      position: relative;
      overflow: hidden;
      /* animated multicolour background for a lively effect */
      background:
        radial-gradient(circle at 0% 0%, rgba(106, 123, 94, 0.12), transparent 50%),
        radial-gradient(circle at 100% 100%, rgba(52, 140, 240, 0.1), transparent 50%),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.98), rgba(248, 253, 246, 0.95));
      background-size: 200% 200%;
      animation: bgMorph 20s infinite alternate;
      border-bottom: 1px solid rgba(106, 123, 94, 0.15);
      padding: 2.5rem 1.5rem;
      margin: 0 -1.5rem 1.5rem -1.5rem;
      text-align: center;
      box-shadow: 0 4px 32px rgba(45, 58, 45, 0.1);
      backdrop-filter: blur(4px);
    }

    .home-modern-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(106, 123, 94, 0.3), transparent);
    }

    /* floating glow effect behind the header */
    .home-modern-header::after {
      content: '';
      position: absolute;
      inset: -10px;
      background: radial-gradient(circle at center, rgba(106, 123, 94, 0.05), transparent 70%);
      filter: blur(16px);
      z-index: -1;
    }

    .home-modern-header__branding {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.8rem;
    }

    .home-modern-header__icon {
      font-size: 2.8rem;
      background: linear-gradient(135deg, #6a7b5e, #4d6450);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .home-modern-header__icon i {
      display: inline-block;
      transition: transform 0.3s ease;
    }

    .home-modern-header__title {
      font-size: 2.2rem;
      font-weight: 700;
      color: #1a3a1a;
      margin: 0;
      letter-spacing: -0.01em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      transition: color 0.3s ease;
    }

    .home-modern-header__title:hover {
      color: #2d3a2d;
    }

    .home-modern-header__tagline {
      font-size: 0.95rem;
      color: #5b6f5d;
      margin: 0.5rem 0 0 0;
      font-weight: 400;
      letter-spacing: 0.01em;
      max-width: 550px;
      margin-left: auto;
      margin-right: auto;
      opacity: 0.85;
      transition: opacity 0.3s ease;
    }

    .home-modern-header__tagline:hover {
      opacity: 1;
    }

    .home-modern-header__accent {
      display: inline-block;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg,
          transparent,
          #6a7b5e 20%,
          #8ba888 50%,
          #6a7b5e 80%,
          transparent);
      background-size: 200% 100%;
      animation: accentMove 4s infinite linear;
      margin-top: 1.2rem;
      border-radius: 2px;
    }

    /* animations */
    @keyframes bgMorph {
      0% {
        background-position: 0% 0%;
      }

      50% {
        background-position: 100% 100%;
      }

      100% {
        background-position: 0% 0%;
      }
    }

    @keyframes accentMove {
      from {
        background-position: 0 0;
      }

      to {
        background-position: -200% 0;
      }
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }

      to {
        transform: rotate(360deg);
      }
    }

    .home-modern-header__wave {
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 50px;
      pointer-events: none;
      z-index: 1;
    }
  </style>
  <script>
    (function () {
      const FEATURE_FLAGS_CACHE_KEY = "rolnopol.featureFlagsCache.v1";
      const FEATURE_FLAGS_MAX_AGE_MS = 30000;

      try {
        const raw = localStorage.getItem(FEATURE_FLAGS_CACHE_KEY);
        if (!raw) {
          return;
        }

        const parsed = JSON.parse(raw);
        if (!parsed || typeof parsed !== "object") {
          return;
        }

        const flags = parsed.flags;
        const timestamp = Number(parsed.timestamp);
        const isFresh = Number.isFinite(timestamp) && Date.now() - timestamp < FEATURE_FLAGS_MAX_AGE_MS;

        if (isFresh && flags && flags.homeModernRestyleEnabled === true) {
          document.documentElement.classList.add("home-modern-prefers-modern");
        }
      } catch (error) {
        // Ignore cache parsing/storage issues.
      }
    })();
  </script>
</head>

<body class="bg-agri-pattern">
  <!-- Dynamic Header Component -->
  <div id="header-component"></div>

  <div class="container" style="margin-top: 1rem; max-width: 900px">
    <header id="home-legacy-header" class="header glass" style="
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 1.2rem 0 1.2rem 0;
          margin-bottom: 1.2rem;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
          border-radius: 1.2rem 1.2rem 0 0;
        ">
      <div style="display: flex; align-items: center; gap: 1.1rem; width: 100%; justify-content: center">
        <h1 style="display: flex; align-items: center; gap: 0.6rem; font-size: 2rem">
          <span class="bg-agri-gradient"><i class="fas fa-tractor"></i></span>
        </h1>
        <div style="display: flex; flex-direction: column; align-items: flex-start">
          <span class="main-title">Rolnopol</span>
          <span style="font-size: 1.08rem; color: #6a7b5e; font-weight: 400; margin-top: 0.1rem">Futuristic Farm & Resource Management</span>
        </div>
      </div>
    </header>

    <main id="home-legacy-main" class="main" style="padding-top: 0">
      <div class="welcome-section bg-futuristic-alt glass fade-in farm-pattern-overlay" style="margin-bottom: 1.2rem; padding: 1.5rem 1.2rem; min-height: unset">
        <h2 style="
              display: flex;
              align-items: center;
              gap: 0.4rem;
              font-size: 1.3rem;
              margin-bottom: 0.2rem;
              font-weight: 500;
              justify-content: center;
            ">
          <i class="fas fa-seedling"></i>
          Welcome to Rolnopol
        </h2>
        <p style="font-size: 1rem; margin: 0">
          Manage your farms, resources, and transactions in a secure, modern environment. Empowering staff, admins, and superadmins for
          the future of agriculture.
        </p>
        <div data-feature-flag="homeWelcomeVideoEnabled" data-feature-flag-default="false" style="margin-top: 1rem">
          <div class="welcome-video-block">
            <div id="home-welcome-video-skeleton" class="welcome-video-skeleton" aria-hidden="true"></div>
            <video id="home-welcome-video" class="welcome-video" style="display: none;;" controls preload="metadata">
              <source src="/images/rolnopol_ad.mp4" type="video/mp4" />
              Your browser does not support the video tag.
            </video>
          </div>
        </div>
      </div>

      <!-- Enhanced General Statistics Section -->
      <div id="general-stats" class="glass futuristic-card" style="margin-bottom: 1.2rem; padding: 1rem 0.8rem; position: relative; overflow: visible">
        <div style="
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              height: 3px;
              background: linear-gradient(90deg, #6a7b5e, #8ba888, #6a7b5e);
            "></div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 0.8rem; align-items: center">
          <div class="stat-block" style="
                text-align: center;
                padding: 0.7rem;
                border-radius: 0.6rem;
                background: rgba(106, 123, 94, 0.05);
                transition: transform 0.2s ease;
              " title="Total number of registered users in the Rolnopol agricultural management system">
            <div style="font-size: 2rem; color: #6a7b5e; margin-bottom: 0.3rem">
              <i class="fas fa-users"></i>
            </div>
            <div id="stat-users" style="font-size: 1.4rem; font-weight: 700; color: #2d3a2d; margin-bottom: 0.2rem">-</div>
            <div style="font-size: 0.9rem; color: #6a7b5e; font-weight: 500">Active Users</div>
            <div style="font-size: 0.75rem; color: #888; margin-top: 0.1rem">
              Growing Community
              <i class="fas fa-info-circle" style="font-size: 0.6rem; margin-left: 0.2rem; opacity: 0.6"></i>
            </div>
          </div>

          <div class="stat-block" style="
                text-align: center;
                padding: 0.7rem;
                border-radius: 0.6rem;
                background: rgba(106, 123, 94, 0.05);
                transition: transform 0.2s ease;
              " title="Total number of farms and agricultural properties managed through the platform">
            <div style="font-size: 2rem; color: #6a7b5e; margin-bottom: 0.3rem">
              <i class="fas fa-tractor"></i>
            </div>
            <div id="stat-farms" style="font-size: 1.4rem; font-weight: 700; color: #2d3a2d; margin-bottom: 0.2rem">-</div>
            <div style="font-size: 0.9rem; color: #6a7b5e; font-weight: 500">Managed Farms</div>
            <div style="font-size: 0.75rem; color: #888; margin-top: 0.1rem">
              Digital Agriculture
              <i class="fas fa-info-circle" style="font-size: 0.6rem; margin-left: 0.2rem; opacity: 0.6"></i>
            </div>
          </div>

          <div class="stat-block" style="
                text-align: center;
                padding: 0.7rem;
                border-radius: 0.6rem;
                background: rgba(106, 123, 94, 0.05);
                transition: transform 0.2s ease;
              " title="Total agricultural land area managed across all farms in hectares and acres">
            <div style="font-size: 2rem; color: #6a7b5e; margin-bottom: 0.3rem">
              <i class="fas fa-ruler-combined"></i>
            </div>
            <div id="stat-area" style="font-size: 1.4rem; font-weight: 700; color: #2d3a2d; margin-bottom: 0.2rem">-</div>
            <div style="font-size: 0.9rem; color: #6a7b5e; font-weight: 500">Total Area (ha)</div>
            <div style="font-size: 0.75rem; color: #888; margin-top: 0.1rem">
              Land Management
              <i class="fas fa-info-circle" style="font-size: 0.6rem; margin-left: 0.2rem; opacity: 0.6"></i>
            </div>
          </div>

          <div class="stat-block" style="
                text-align: center;
                padding: 0.7rem;
                border-radius: 0.6rem;
                background: rgba(106, 123, 94, 0.05);
                transition: transform 0.2s ease;
              " title="Total number of staff members and workers employed across all agricultural operations">
            <div style="font-size: 2rem; color: #6a7b5e; margin-bottom: 0.3rem">
              <i class="fas fa-users-cog"></i>
            </div>
            <div id="stat-staff" style="font-size: 1.4rem; font-weight: 700; color: #2d3a2d; margin-bottom: 0.2rem">-</div>
            <div style="font-size: 0.9rem; color: #6a7b5e; font-weight: 500">Total Staff</div>
            <div style="font-size: 0.75rem; color: #888; margin-top: 0.1rem">
              Team Management
              <i class="fas fa-info-circle" style="font-size: 0.6rem; margin-left: 0.2rem; opacity: 0.6"></i>
            </div>
          </div>

          <div class="stat-block" style="
                text-align: center;
                padding: 0.7rem;
                border-radius: 0.6rem;
                background: rgba(106, 123, 94, 0.05);
                transition: transform 0.2s ease;
              " title="Total number of livestock animals including cattle, pigs, chickens, and other farm animals">
            <div style="font-size: 2rem; color: #6a7b5e; margin-bottom: 0.3rem">
              <i class="fas fa-cow"></i>
            </div>
            <div id="stat-animals" style="font-size: 1.4rem; font-weight: 700; color: #2d3a2d; margin-bottom: 0.2rem">-</div>
            <div style="font-size: 0.9rem; color: #6a7b5e; font-weight: 500">Stock Animals</div>
            <div style="font-size: 0.75rem; color: #888; margin-top: 0.1rem">
              Livestock Count
              <i class="fas fa-info-circle" style="font-size: 0.6rem; margin-left: 0.2rem; opacity: 0.6"></i>
            </div>
          </div>
        </div>

        <div data-feature-flag="homeStatsSectionEnabled" data-feature-flag-default="false" style="margin-top: 1rem; border-top: 1px dashed rgba(106, 123, 94, 0.2); padding-top: 1rem">
          <h3 style="margin: 0 0 0.75rem 0; color: #2d3a2d; font-size: 1rem; text-align: center">
            <i class="fas fa-chart-line" style="margin-right: 0.4rem; color: #6a7b5e"></i>
            Advanced Farm Intelligence
          </h3>
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.7rem">
            <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Average land area managed by one farm account.">
              <div style="font-size: 0.8rem; color: #6a7b5e">Avg area / farm</div>
              <div id="advanced-stat-area-per-farm" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
            </div>
            <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Average number of animals handled by one staff member.">
              <div style="font-size: 0.8rem; color: #6a7b5e">Animals / staff</div>
              <div id="advanced-stat-animals-per-staff" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
            </div>
            <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Average value of currently active marketplace offers.">
              <div style="font-size: 0.8rem; color: #6a7b5e">Avg offer value</div>
              <div id="advanced-stat-offer-value" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
            </div>
            <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Number of completed marketplace transactions.">
              <div style="font-size: 0.8rem; color: #6a7b5e">Completed deals</div>
              <div id="advanced-stat-completed-transactions" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
            </div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(106, 123, 94, 0.1)">
          <p style="font-size: 0.95rem; color: #6a7b5e; margin: 0 0 1rem 0">
            <i class="fas fa-info-circle" style="margin-right: 0.5rem"></i>
            Join thousands of farmers already using Rolnopol to modernize their operations
          </p>
          <div id="staff-info" style="display: none; font-size: 0.85rem; color: #888; margin-bottom: 1rem"></div>
          <div id="cta-section" style="display: none">
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap">
              <a href="/register.html" class="btn btn-agri" style="
                    padding: 0.8rem 1.5rem;
                    font-size: 1rem;
                    font-weight: 600;
                    text-decoration: none;
                    border-radius: 0.8rem;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(106, 123, 94, 0.2);
                  ">
                <i class="fas fa-user-plus" style="margin-right: 0.5rem"></i>
                Get Started Free
              </a>
              <a href="/login.html" class="btn" style="
                    padding: 0.8rem 1.5rem;
                    font-size: 1rem;
                    font-weight: 600;
                    text-decoration: none;
                    border-radius: 0.8rem;
                    background: rgba(106, 123, 94, 0.1);
                    color: #6a7b5e;
                    transition: all 0.3s ease;
                  ">
                <i class="fas fa-sign-in-alt" style="margin-right: 0.5rem"></i>
                Sign In
              </a>
            </div>
            <p style="font-size: 0.85rem; color: #888; margin-top: 0.8rem; margin-bottom: 0">
              <i class="fas fa-clock" style="margin-right: 0.3rem"></i>
              Setup takes less than 2 minutes
            </p>
          </div>
        </div>
      </div>
    </main>

    <main class="main home-modern-main js-home-modern-main" data-feature-flag="homeModernRestyleEnabled" data-feature-flag-default="false" style="display: none; padding-top: 0"></main>

    <!-- Dynamic Footer Component -->
    <div id="footer-component"></div>
  </div>

  <!-- Core Dependencies -->
  <script src="/js/core/event-bus.js"></script>
  <script src="/js/core/storage.js"></script>
  <script src="/js/core/app.js"></script>
  <!-- Services -->
  <script src="/js/services/api-service.js"></script>
  <script src="/js/services/auth-service.js"></script>
  <script src="/js/services/feature-flags-service.js"></script>

  <!-- Components -->
  <script src="/js/components/notification.js"></script>
  <script src="/js/components/navigation.js"></script>
  <script src="/js/components/form.js"></script>
  <script src="/js/components.js"></script>

  <!-- API Functions -->
  <script src="/js/api.js"></script>

  <!-- Utilities -->
  <script src="/js/utils/error-logger.js"></script>
  <script src="/js/utils/utils.js"></script>
  <script src="/js/utils/router.js"></script>
  <script src="/js/utils/global-compat.js"></script>

  <!-- Main Application -->
  <script src="/js/app.js"></script>
  <script>
    // Global logout function
    function logout() {
      if (window.App && window.App.getModule("authService")) {
        const authService = window.App.getModule("authService");
        authService
          .logout()
          .then(() => {
            window.location.reload();
          })
          .catch((error) => {
            errorLogger.log("Logout", error, { showToUser: false });
            window.location.reload();
          });
      } else {
        // Fallback logout
        localStorage.removeItem("authToken");
        sessionStorage.removeItem("authToken");
        window.location.reload();
      }
    }

    // Initialize navigation after DOM is loaded
    document.addEventListener("DOMContentLoaded", async function () {
      // Load the header component
      const headerElement = document.getElementById("header-component");
      if (headerElement) {
        try {
          const response = await fetch("/components/header.html");
          const html = await response.text();
          headerElement.innerHTML = html;

          // Initialize navigation after header is loaded
          if (typeof updateHeaderNav === "function") {
            // Check authentication status using standardized cookie names
            const token = getCookie("rolnopolToken");
            const isLogged = getCookie("rolnopolIsLogged");
            const username = getCookie("rolnopolUserLabel") || getCookie("rolnopolUsername");
            if (token && (isLogged === "true" || isLogged === true)) {
              try {
                const userData = await getUserInfo();
                updateHeaderNav(userData.displayedName || userData.email || username || "User");
              } catch (error) {
                errorLogger.log("User Info Loading", error, {
                  showToUser: false,
                });
                updateHeaderNav(username || "User");
              }
            } else {
              updateHeaderNav();
            }

            // Set active navigation link for home page
            // setActiveNavLink('home'); // This line is now handled by initNavigation
          }
        } catch (error) {
          errorLogger.log("Header Component Loading", error, {
            showToUser: false,
          });
        }
      }

      // Load the footer component
      if (typeof initFooter === "function") {
        await initFooter();
      }
    });
  </script>
  <script>
    // Dashboard dynamic info loader
    document.addEventListener("DOMContentLoaded", async function () {
      // User info summary
      const recentActivityDiv = document.getElementById("recent-activity");
      let userData = null;
      let isLogged = false;
      let role = "Guest";
      let group = "-";
      let balance = "-";

      // Try to get user info if logged in
      try {
        if (window.App && window.App.getModule("authService")) {
          const authService = window.App.getModule("authService");
          isLogged = await authService.isAuthenticated();
          if (isLogged) {
            userData = await authService.getCurrentUser();
            role = userData.role || userData.userRole || "User";
            group = userData.groupName || userData.group || "-";
            balance = typeof userData.balance !== "undefined" ? userData.balance + " ₡" : "-";
          }
        }
      } catch (e) {
        // fallback to guest
      }

      // Update dashboard links if pages exist
      const links = [
        { selector: ".dashboard-card .btn.btn-agri", href: "/farms.html" },
        { selector: ".dashboard-card .btn.btn-earth", href: "/group.html" },
        {
          selector: ".dashboard-card .btn.btn-futuristic",
          href: "/marketplace.html",
        },
        { selector: ".dashboard-card .btn.btn-agri", href: "/shop.html" },
        { selector: ".dashboard-card .btn.btn-earth", href: "/finance.html" },
        {
          selector: ".dashboard-card .btn.btn-futuristic",
          href: "/admin.html",
        },
      ];
      // Only update if those pages exist, otherwise leave as #
      links.forEach((link, i) => {
        const btns = document.querySelectorAll(link.selector);
        if (btns[i]) btns[i].setAttribute("href", link.href);
      });
    });
  </script>
  <script>
    // Header auth links dynamic loader
    document.addEventListener("DOMContentLoaded", async function () {
      const authLinks = document.getElementById("header-auth-links");
      let isLogged = false;
      let userData = null;
      try {
        if (window.App && window.App.getModule("authService")) {
          const authService = window.App.getModule("authService");
          isLogged = await authService.isAuthenticated();
          if (isLogged) {
            userData = await authService.getCurrentUser();
          }
        }
      } catch (e) { }
      if (authLinks) {
        if (isLogged) {
          authLinks.innerHTML = `
                        <a href="/profile.html" class="nav-link" style="font-size:1.05rem;padding:0.4rem 1.1rem;border-radius:0.7rem;text-decoration:none;color:#2d3a2d;font-weight:500;"><i class='fas fa-user'></i> ${(userData && (userData.displayedName || userData.email)) || "Profile"}</a>
                        <a href="#" onclick="logout();return false;" class="nav-link" style="font-size:1.05rem;padding:0.4rem 1.1rem;border-radius:0.7rem;text-decoration:none;color:#b23b3b;font-weight:500;"><i class='fas fa-sign-out-alt'></i> Logout</a>
                    `;
        } else {
          authLinks.innerHTML = `
                        <a href="/login.html" class="nav-link" style="font-size:1.05rem;padding:0.4rem 1.1rem;border-radius:0.7rem;text-decoration:none;color:#2d3a2d;font-weight:500;">Login</a>
                        <a href="/register.html" class="nav-link" style="font-size:1.05rem;padding:0.4rem 1.1rem;border-radius:0.7rem;text-decoration:none;color:#2d3a2d;font-weight:500;">Register</a>
                    `;
        }
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const videoPairs = [
        {
          video: document.getElementById("home-welcome-video"),
          skeleton: document.getElementById("home-welcome-video-skeleton"),
        },
        {
          video: document.getElementById("modern-home-welcome-video"),
          skeleton: document.getElementById("modern-home-welcome-video-skeleton"),
        },
      ];

      videoPairs.forEach(({ video, skeleton }) => {
        if (!video || !skeleton) {
          return;
        }

        const revealVideo = () => {
          video.style.display = "block";
          video.classList.add("is-loaded");
          skeleton.classList.add("is-hidden");
        };

        if (video.readyState >= 1) {
          revealVideo();
          return;
        }

        video.addEventListener("loadeddata", revealVideo, { once: true });
        video.addEventListener("error", revealVideo, { once: true });
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const legacyMain = document.getElementById("home-legacy-main");
      const modernMain = document.querySelector(".js-home-modern-main");
      if (modernMain && modernMain.id !== "home-modern-main") {
        modernMain.id = "home-modern-main";
      }

      if (modernMain) {
        modernMain.innerHTML = `
          <header class="home-modern-header">
            <div class="home-modern-header__branding">
              <div class="home-modern-header__icon">
                <i class="fas fa-tractor"></i>
              </div>
              <div style="text-align: left">
                <h1 class="home-modern-header__title">Rolnopol</h1>
                <p class="home-modern-header__tagline">Modern Agricultural Management Platform</p>
              </div>
            </div>
            <div class="home-modern-header__accent"></div>
            <!-- decorative wavy bottom edge -->
            <svg class="home-modern-header__wave" viewBox="0 0 1200 100" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M0,0 C300,100 900,0 1200,100 L1200,0 L0,0 Z" fill="#f4f7f2" />
            </svg>
          </header>

          <section class="home-modern-hero glass fade-in">
            
            <p class="home-modern-subtitle">
              A fresher and more elegant view of your farm operations - with faster insight into users, fields, staff, and livestock.
            </p>

            <div data-feature-flag="homeWelcomeVideoEnabled" data-feature-flag-default="false" style="margin-top: 0.9rem">
              <div class="welcome-video-block">
                <div id="modern-home-welcome-video-skeleton" class="welcome-video-skeleton" aria-hidden="true"></div>
                <video id="modern-home-welcome-video" class="welcome-video" style="display: none" controls preload="metadata">
                  <source src="/images/rolnopol_ad.mp4" type="video/mp4" />
                  Your browser does not support the video tag.
                </video>
              </div>
            </div>

            <div class="home-modern-grid">
              <article class="home-modern-kpi" title="Total number of registered users in the Rolnopol agricultural management system">
                <div class="home-modern-kpi__icon"><i class="fas fa-users"></i></div>
                <div id="modern-stat-users" class="home-modern-kpi__value">-</div>
                <div class="home-modern-kpi__label">Users</div>
              </article>
              <article class="home-modern-kpi" title="Total number of farms and agricultural properties managed through the platform">
                <div class="home-modern-kpi__icon"><i class="fas fa-tractor"></i></div>
                <div id="modern-stat-farms" class="home-modern-kpi__value">-</div>
                <div class="home-modern-kpi__label">Farms</div>
              </article>
              <article class="home-modern-kpi" title="Total agricultural land area managed across all farms">
                <div class="home-modern-kpi__icon"><i class="fas fa-ruler-combined"></i></div>
                <div id="modern-stat-area" class="home-modern-kpi__value">-</div>
                <div class="home-modern-kpi__label">Area (ha)</div>
              </article>
              <article class="home-modern-kpi" title="Total number of staff members and workers employed across all agricultural operations">
                <div class="home-modern-kpi__icon"><i class="fas fa-users-cog"></i></div>
                <div id="modern-stat-staff" class="home-modern-kpi__value">-</div>
                <div class="home-modern-kpi__label">Staff</div>
              </article>
              <article class="home-modern-kpi" title="Total number of livestock animals including cattle, pigs, chickens, and other farm animals">
                <div class="home-modern-kpi__icon"><i class="fas fa-cow"></i></div>
                <div id="modern-stat-animals" class="home-modern-kpi__value">-</div>
                <div class="home-modern-kpi__label">Animals</div>
              </article>
            </div>

            <div data-feature-flag="homeStatsSectionEnabled" data-feature-flag-default="false" style="margin-top: 1rem; border-top: 1px dashed rgba(106, 123, 94, 0.25); padding-top: 0.95rem">
              <h3 style="margin: 0 0 0.75rem 0; color: #2d3a2d; font-size: 1rem; text-align: center">
                <i class="fas fa-chart-line" style="margin-right: 0.4rem; color: #6a7b5e"></i>
                Advanced Farm Intelligence
              </h3>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.7rem">
                <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Average land area managed by one farm account.">
                  <div style="font-size: 0.8rem; color: #6a7b5e">Avg area / farm</div>
                  <div id="modern-advanced-stat-area-per-farm" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
                </div>
                <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Average number of animals handled by one staff member.">
                  <div style="font-size: 0.8rem; color: #6a7b5e">Animals / staff</div>
                  <div id="modern-advanced-stat-animals-per-staff" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
                </div>
                <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Average value of currently active marketplace offers.">
                  <div style="font-size: 0.8rem; color: #6a7b5e">Avg offer value</div>
                  <div id="modern-advanced-stat-offer-value" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
                </div>
                <div class="stat-block" style="text-align: center; padding: 0.65rem; border-radius: 0.6rem; background: rgba(106, 123, 94, 0.08)" title="Number of completed marketplace transactions.">
                  <div style="font-size: 0.8rem; color: #6a7b5e">Completed deals</div>
                  <div id="modern-advanced-stat-completed-transactions" style="font-size: 1.1rem; font-weight: 700; color: #2d3a2d">-</div>
                </div>
              </div>
            </div>

            <div class="home-modern-actions">
              <a href="/register.html" class="btn btn-agri"><i class="fas fa-user-plus" style="margin-right: 0.35rem"></i>Start Free</a>
              <a href="/login.html" class="btn btn-outline"><i class="fas fa-sign-in-alt" style="margin-right: 0.35rem"></i>Sign In</a>
            </div>

            <p class="home-modern-note">
              <i class="fas fa-info-circle" style="margin-right: 0.5rem"></i>
              Experience the future of farm management with Rolnopol's modern dashboard.
            </p>
          </section>
        `;

        // Setup video loading for modern video elements (after innerHTML is set)
        setTimeout(() => {
          const modernVideo = document.getElementById("modern-home-welcome-video");
          const modernSkeleton = document.getElementById("modern-home-welcome-video-skeleton");
          if (modernVideo && modernSkeleton) {
            const revealModernVideo = () => {
              modernVideo.style.display = "block";
              modernVideo.classList.add("is-loaded");
              modernSkeleton.classList.add("is-hidden");
            };

            if (modernVideo.readyState >= 1) {
              revealModernVideo();
            } else {
              modernVideo.addEventListener("loadeddata", revealModernVideo, { once: true });
              modernVideo.addEventListener("error", revealModernVideo, { once: true });
            }
          }
        }, 0);
      }

      if (!legacyMain || !modernMain) {
        return;
      }

      const legacyHeader = document.getElementById("home-legacy-header");

      const applyToggle = (enabled) => {
        document.documentElement.classList.toggle("home-modern-prefers-modern", enabled === true);

        if (enabled) {
          legacyMain.style.display = "none";
          if (legacyHeader) legacyHeader.style.display = "none";
          modernMain.style.removeProperty("display");
          modernMain.setAttribute("data-feature-flag-enabled", "true");
          modernMain.removeAttribute("data-feature-flag-hidden");
        } else {
          legacyMain.style.removeProperty("display");
          if (legacyHeader) legacyHeader.style.removeProperty("display");
        }
      };

      const waitForFeatureFlagsService = async (maxAttempts = 40) => {
        for (let attempt = 0; attempt < maxAttempts; attempt += 1) {
          const service = window.App?.getModule?.("featureFlagsService");
          if (service && typeof service.isEnabled === "function") {
            return service;
          }
          await new Promise((resolve) => setTimeout(resolve, attempt < 15 ? 50 : 150));
        }
        return null;
      };

      const checkAndApplyModernLayout = async (featureFlagsService) => {
        if (!featureFlagsService) {
          return;
        }
        try {
          const modernEnabled = await featureFlagsService.isEnabled("homeModernRestyleEnabled", false);
          applyToggle(modernEnabled === true);
        } catch (error) {
          // Keep legacy layout on failure.
        }
      };

      (async () => {
        const featureFlagsService = await waitForFeatureFlagsService();
        if (!featureFlagsService) {
          return;
        }

        // Check and apply the toggle on initial page load
        await checkAndApplyModernLayout(featureFlagsService);

        // Listen for feature flag changes and re-apply instantly
        const app = window.App;
        if (app && typeof app.getEventBus === "function") {
          const eventBus = app.getEventBus();
          if (eventBus) {
            eventBus.on("feature-flags:changed", () => {
              checkAndApplyModernLayout(featureFlagsService);
            });
          }
        }
      })();
    });
  </script>

  <script>
    // Enhanced general statistics loader with animations
    document.addEventListener("DOMContentLoaded", async function () {
      // Add hover effects to stat blocks
      const statBlocks = document.querySelectorAll(".stat-block");
      statBlocks.forEach((block) => {
        block.addEventListener("mouseenter", function () {
          this.style.transform = "translateY(-5px)";
          this.style.boxShadow = "0 8px 25px rgba(106,123,94,0.15)";
        });
        block.addEventListener("mouseleave", function () {
          this.style.transform = "translateY(0)";
          this.style.boxShadow = "none";
        });
      });

      // Check if user is logged in and show/hide CTA accordingly
      let isLoggedIn = false;
      try {
        if (window.App && window.App.getModule("authService")) {
          const authService = window.App.getModule("authService");
          isLoggedIn = await authService.isAuthenticated();
        } else {
          // Fallback check
          const token = getCookie("rolnopolToken");
          const isLogged = getCookie("rolnopolIsLogged");
          isLoggedIn = token && (isLogged === "true" || isLogged === true);
        }
      } catch (e) {
        isLoggedIn = false;
      }

      // Show CTA section for non-logged-in users
      const ctaSection = document.getElementById("cta-section");
      if (ctaSection && !isLoggedIn) {
        ctaSection.style.display = "block";
        // Add fade-in animation
        ctaSection.style.opacity = "0";
        ctaSection.style.transform = "translateY(20px)";
        ctaSection.style.transition = "all 0.6s ease";
        setTimeout(() => {
          ctaSection.style.opacity = "1";
          ctaSection.style.transform = "translateY(0)";
        }, 500);
      }

      // Helper functions for statistics animation and formatting
      // Animate statistics loading with formatting and tooltips
      const animateValue = (element, start, end, duration, isArea = false, type = "") => {
        const startTime = performance.now();

        // Add tooltip with full value and context
        const fullValue = isArea ? formatFullArea(end) : formatFullNumber(end, type);
        element.title = fullValue;

        const updateValue = (currentTime) => {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const current = Math.floor(start + (end - start) * progress);
          element.textContent = isArea ? formatArea(current) : formatNumber(current);

          if (progress < 1) {
            requestAnimationFrame(updateValue);
          }
        };
        requestAnimationFrame(updateValue);
      };

      // Safe value converter and formatter for frontend
      const safeValue = (value) => {
        const num = parseInt(value);
        if (isNaN(num) || num < 0) {
          return Math.floor(Math.random() * 100) + 10;
        }
        return num;
      };

      // Format large numbers with K, M, G, T, P, E suffixes using Polish locale
      const formatNumber = (num) => {
        if (num >= 1000000000000000000) {
          // Quintillion
          return (
            (num / 1000000000000000000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "E"
          );
        } else if (num >= 1000000000000000) {
          // Quadrillion
          return (
            (num / 1000000000000000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "P"
          );
        } else if (num >= 1000000000000) {
          // Trillion
          return (
            (num / 1000000000000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "T"
          );
        } else if (num >= 1000000000) {
          // Billion
          return (
            (num / 1000000000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "G"
          );
        } else if (num >= 1000000) {
          // Million
          return (
            (num / 1000000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "M"
          );
        } else if (num >= 1000) {
          // Thousand
          return (
            (num / 1000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "K"
          );
        }
        return num.toLocaleString("pl-PL");
      };

      // Format area with appropriate units using Polish locale
      const formatArea = (num) => {
        if (num >= 1000000) {
          // Million hectares
          return (
            (num / 1000000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "M ha"
          );
        } else if (num >= 1000) {
          // Thousand hectares
          return (
            (num / 1000).toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + "K ha"
          );
        } else if (num >= 1) {
          // Hectares
          return (
            num.toLocaleString("pl-PL", {
              minimumFractionDigits: 1,
              maximumFractionDigits: 1,
            }) + " ha"
          );
        } else if (num >= 0.01) {
          // Centihectares (100 m²)
          return (
            (num * 100).toLocaleString("pl-PL", {
              minimumFractionDigits: 0,
              maximumFractionDigits: 0,
            }) + " m²"
          );
        } else {
          // Square meters
          return (
            (num * 10000).toLocaleString("pl-PL", {
              minimumFractionDigits: 0,
              maximumFractionDigits: 0,
            }) + " m²"
          );
        }
      };

      // Format full number with Polish locale and context for tooltip
      const formatFullNumber = (num, type) => {
        const formatted = num.toLocaleString("pl-PL");
        switch (type) {
          case "users":
            return `${formatted} registered users across all farms`;
          case "farms":
            return `${formatted} managed farms and agricultural properties`;
          case "staff":
            return `${formatted} staff members working in agriculture`;
          case "animals":
            return `${formatted} livestock animals across all farms`;
          default:
            return formatted;
        }
      };

      // Format full area with detailed context for tooltip using Polish locale
      const formatFullArea = (num) => {
        if (num >= 1) {
          const hectares = num.toLocaleString("pl-PL");
          const acres = Math.round(num * 2.471).toLocaleString("pl-PL");
          return `${hectares} hectares (${acres} acres) of agricultural land`;
        } else {
          const sqMeters = (num * 10000).toLocaleString("pl-PL");
          const sqFeet = Math.round(num * 10000 * 10.764).toLocaleString("pl-PL");
          return `${sqMeters} square meters (${sqFeet} sq ft) of land`;
        }
      };

      const formatCurrency = (num) => {
        return `${Number(num || 0).toLocaleString("pl-PL", {
          minimumFractionDigits: 0,
          maximumFractionDigits: 2,
        })} ₡`;
      };

      // Load statistics with animation
      try {
        const res = await fetch("/api/v1/statistics");
        if (!res.ok) throw new Error("Failed to fetch");
        const stats = await res.json();

        // Animate each statistic with safe values and formatting
        const usersElement = document.getElementById("stat-users");
        const farmsElement = document.getElementById("stat-farms");
        const areaElement = document.getElementById("stat-area");
        const staffElement = document.getElementById("stat-staff");
        const animalsElement = document.getElementById("stat-animals");

        if (usersElement && stats.users !== undefined) {
          const safeUsers = safeValue(stats.users);
          animateValue(usersElement, 0, safeUsers, 1500, false, "users");
          const modernUsersElement = document.getElementById("modern-stat-users");
          if (modernUsersElement) {
            animateValue(modernUsersElement, 0, safeUsers, 1500, false, "users");
          }
        }
        if (farmsElement && stats.farms !== undefined) {
          const safeFarms = safeValue(stats.farms);
          animateValue(farmsElement, 0, safeFarms, 1500, false, "farms");
          const modernFarmsElement = document.getElementById("modern-stat-farms");
          if (modernFarmsElement) {
            animateValue(modernFarmsElement, 0, safeFarms, 1500, false, "farms");
          }
        }
        if (areaElement && stats.area !== undefined) {
          const safeArea = safeValue(stats.area);
          animateValue(areaElement, 0, safeArea, 1500, true); // true for area formatting
          const modernAreaElement = document.getElementById("modern-stat-area");
          if (modernAreaElement) {
            animateValue(modernAreaElement, 0, safeArea, 1500, true);
          }
        }
        if (staffElement && stats.staff !== undefined) {
          const safeStaff = safeValue(stats.staff);
          animateValue(staffElement, 0, safeStaff, 1500, false, "staff");
          const modernStaffElement = document.getElementById("modern-stat-staff");
          if (modernStaffElement) {
            animateValue(modernStaffElement, 0, safeStaff, 1500, false, "staff");
          }
        }
        if (animalsElement && stats.animals !== undefined) {
          const safeAnimals = safeValue(stats.animals);
          animateValue(animalsElement, 0, safeAnimals, 1500, false, "animals");
          const modernAnimalsElement = document.getElementById("modern-stat-animals");
          if (modernAnimalsElement) {
            animateValue(modernAnimalsElement, 0, safeAnimals, 1500, false, "animals");
          }
        }

        const advancedStats = stats.advanced || {};
        const areaPerFarmValue =
          typeof advancedStats.avgAreaPerFarm === "number" ? advancedStats.avgAreaPerFarm : stats.farms > 0 ? Number((stats.area / stats.farms).toFixed(2)) : 0;
        const animalsPerStaffValue =
          typeof advancedStats.avgAnimalsPerStaff === "number"
            ? advancedStats.avgAnimalsPerStaff
            : stats.staff > 0
              ? Number((stats.animals / stats.staff).toFixed(2))
              : 0;
        const avgOfferValue = typeof advancedStats.avgOfferValue === "number" ? advancedStats.avgOfferValue : 0;
        const completedTransactions =
          typeof advancedStats.completedTransactions === "number" ? advancedStats.completedTransactions : 0;

        const advancedAreaPerFarmElement = document.getElementById("advanced-stat-area-per-farm");
        const advancedAnimalsPerStaffElement = document.getElementById("advanced-stat-animals-per-staff");
        const advancedOfferValueElement = document.getElementById("advanced-stat-offer-value");
        const advancedCompletedTransactionsElement = document.getElementById("advanced-stat-completed-transactions");
        const modernAdvancedAreaPerFarmElement = document.getElementById("modern-advanced-stat-area-per-farm");
        const modernAdvancedAnimalsPerStaffElement = document.getElementById("modern-advanced-stat-animals-per-staff");
        const modernAdvancedOfferValueElement = document.getElementById("modern-advanced-stat-offer-value");
        const modernAdvancedCompletedTransactionsElement = document.getElementById("modern-advanced-stat-completed-transactions");

        if (advancedAreaPerFarmElement) {
          advancedAreaPerFarmElement.textContent = `${areaPerFarmValue.toLocaleString("pl-PL", {
            minimumFractionDigits: 1,
            maximumFractionDigits: 2,
          })} ha`;
        }
        if (advancedAnimalsPerStaffElement) {
          advancedAnimalsPerStaffElement.textContent = animalsPerStaffValue.toLocaleString("pl-PL", {
            minimumFractionDigits: 1,
            maximumFractionDigits: 2,
          });
        }
        if (advancedOfferValueElement) {
          advancedOfferValueElement.textContent = formatCurrency(avgOfferValue);
        }
        if (advancedCompletedTransactionsElement) {
          advancedCompletedTransactionsElement.textContent = completedTransactions.toLocaleString("pl-PL");
        }
        if (modernAdvancedAreaPerFarmElement) {
          modernAdvancedAreaPerFarmElement.textContent = `${areaPerFarmValue.toLocaleString("pl-PL", {
            minimumFractionDigits: 1,
            maximumFractionDigits: 2,
          })} ha`;
        }
        if (modernAdvancedAnimalsPerStaffElement) {
          modernAdvancedAnimalsPerStaffElement.textContent = animalsPerStaffValue.toLocaleString("pl-PL", {
            minimumFractionDigits: 1,
            maximumFractionDigits: 2,
          });
        }
        if (modernAdvancedOfferValueElement) {
          modernAdvancedOfferValueElement.textContent = formatCurrency(avgOfferValue);
        }
        if (modernAdvancedCompletedTransactionsElement) {
          modernAdvancedCompletedTransactionsElement.textContent = completedTransactions.toLocaleString("pl-PL");
        }

        // Show staff info if available with safe values
        const staffInfoElement = document.getElementById("staff-info");
        if (staffInfoElement) {
          staffInfoElement.style.display = "block";
          // Add fade-in animation
          staffInfoElement.style.opacity = "0";
          staffInfoElement.style.transition = "opacity 0.6s ease";
          setTimeout(() => {
            staffInfoElement.style.opacity = "1";
          }, 2000);
          // Display one random info about stats
          // Calculate contextual stats
          const users = safeValue(stats.users);
          const farms = safeValue(stats.farms);
          const area = safeValue(stats.area);
          const staff = safeValue(stats.staff);
          const animals = safeValue(stats.animals);
          const avgStaffAge = safeValue(stats.avgStaffAge);
          const safeAvgAge = safeValue(stats.avgStaffAge);

          // Calculated facts
          const avgAreaPerFarm = farms > 0 ? (area / farms).toFixed(2) : "-";
          const avgAnimalsPerFarm = farms > 0 ? Math.round(animals / farms) : "-";
          const avgStaffPerFarm = farms > 0 ? Math.round(staff / farms) : "-";
          const avgAnimalsPerStaff = staff > 0 ? Math.round(animals / staff) : "-";

          const statFacts = [
            `Each farm manages on average ${avgAreaPerFarm} hectares of land.`,
            `There are about ${avgAnimalsPerFarm} animals per farm.`,
            `Each staff member cares for about ${avgAnimalsPerStaff} animals.`,
            `Average staff per farm: ${avgStaffPerFarm}.`,
            `Average staff age: ${avgStaffAge} years.`,
          ];
          const randomFact = statFacts[Math.floor(Math.random() * statFacts.length)];
          const factSpan = document.createElement("span");
          factSpan.style.display = "block";
          factSpan.style.marginTop = "0.4rem";
          factSpan.style.fontSize = "0.85rem";
          factSpan.style.color = "#6a7b5e";
          factSpan.textContent = randomFact;
          const icon = document.createElement("i");
          icon.className = "fas fa-leaf";
          icon.style.marginRight = "0.3rem";
          // append at beginning
          factSpan.prepend(icon);
          staffInfoElement.appendChild(factSpan);
        }
      } catch (e) {
        // Fallback values with animation
        const elements = [
          { id: "stat-users", isArea: false, type: "users" },
          { id: "stat-farms", isArea: false, type: "farms" },
          { id: "stat-area", isArea: true, type: "" },
          { id: "stat-staff", isArea: false, type: "staff" },
          { id: "stat-animals", isArea: false, type: "animals" },
          { id: "modern-stat-users", isArea: false, type: "users" },
          { id: "modern-stat-farms", isArea: false, type: "farms" },
          { id: "modern-stat-area", isArea: true, type: "" },
          { id: "modern-stat-staff", isArea: false, type: "staff" },
          { id: "modern-stat-animals", isArea: false, type: "animals" },
        ];
        elements.forEach((item) => {
          const element = document.getElementById(item.id);
          if (element) {
            const fallbackValue = Math.floor(Math.random() * 50) + 10;
            animateValue(element, 0, fallbackValue, 1000, item.isArea, item.type);
          }
        });

        const advancedFallbackIds = [
          "advanced-stat-area-per-farm",
          "advanced-stat-animals-per-staff",
          "advanced-stat-offer-value",
          "advanced-stat-completed-transactions",
          "modern-advanced-stat-area-per-farm",
          "modern-advanced-stat-animals-per-staff",
          "modern-advanced-stat-offer-value",
          "modern-advanced-stat-completed-transactions",
        ];
        advancedFallbackIds.forEach((id) => {
          const element = document.getElementById(id);
          if (element) {
            element.textContent = "-";
          }
        });
      }
    });
  </script>

  <!-- Load necessary JavaScript files -->
  <script src="/js/app.js"></script>
  <script src="/js/utils/init-navigation.js"></script>

  <script>
    initNavigation("home");
  </script>
</body>

</html>